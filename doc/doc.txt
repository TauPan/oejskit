jskit
=======

jskit contains infrastructure and in particular a py.test (XXX link) plugin to
enable running tests for JavaScript code inside browsers directly
using py.test as the test driver. Running inside the browsers comes
with some speed cost, on the other hand it means for example the code
is tested against the real-word DOM implementations. 

The approach also enables to write integration tests such that the
JavaScript code is tested against server-side Python code mocked as
necessary. Any server-side framework that can already be exposed
through WSGI (or for which a subset of WSGI can be written to
accommodate the jskit own needs XXX pointer ) can play along.

jskit also contains contain code to help modularizing JavaScript code
which can be used to describe and track dependencies dynamically
during development and that can help resolving them statically when
deploying/packaging.

jskit depends on simplejson. It also uses MochiKit - of which it ships a
version within itself for convenience - for its own working though in
does not imposes its usage on tested code.

Basics of writing and running tests
------------------------------------

For the simplest cases jskit allows to write tests simply as just
JavaScript files. As an example one could have a jstest_example_any.js
in a test directory in a project::

    Tests = {

    test_simple: function() {
        ais(21*2, 42)
    }

    }

``jstest_*.js`` is the globbing pattern used by jskit to recognize
JavaScript test files. Each of these need to contain a ``Tests``
object with test methods starting with ``test_``. ``ais`` is one of
the assertion functions predefined by jskit, it raises an exception
causing the test to fail if the two arguments are not equal (in
JavaScript ``=`` sense).

The suffix ``any`` separated by an underscore (``_``) in the test file name controls the kind of browsers the test should be run against, ``any`` is predefined by jskit to be

- Firefox and Safari on Mac OS X
- Internet Explorer and Firefox on Windows
- Firefox (started as ``firefox``) otherwise (e.g. Linux)

later we'll see how to define other groups of browsers.

To run the test we need to use py.test with the jskit plugin
activated, a ``conftest.py`` file at the top of the project with::

    pytest_plugins = ["jstests"]

should work. (XXX pointer to plugin usage docs)

Running the test is just a matter of invoking ``py.test`` that has an installed jskit available on the Python path::

    $ ../v/bin/py.test test/
    inserting into sys.path: /u/pedronis/scratch/oejskit-play/v/lib/python2.5/site-packages
    ========================================= test session starts =========================================
    python: platform linux2 -- Python 2.5.2
    test object 1: /u/pedronis/scratch/oejskit-play/proj/test

    test/jstest_example_any.js .

    ====================================== 1 passed in 2.52 seconds =======================================

(concretely here I'm using a `virtualenv` with both the `py.lib` and the ``oejskit`` egg installed in it)

